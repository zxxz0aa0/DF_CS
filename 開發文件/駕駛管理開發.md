# 駕駛管理開發規劃文件

此文件為駕駛管理系統開發的完整規劃文件，詳細記錄專案背景、需求分析、技術架構、開發計畫等。

## 📋 專案概述

### 專案背景
企業集團需要統一管理旗下駕駛的基本資料，以建立完整的企業架構管理系統。此系統將整合現有的公司分類體系，並為未來的行費管理功能預留擴展空間。

### 專案目標
- 建立統一的駕駛資料管理平台
- 提供完整的駕駛生命週期管理
- 整合企業現有的分類架構
- 支援證照到期提醒功能
- 建立可擴展的資料架構

### 專案範圍
- 駕駛基本資料管理（CRUD）
- 證照與執照管理
- 車隊歸屬管理
- 聯絡資訊管理
- 狀態追蹤管理

## 🎯 功能需求

### 核心功能

#### 1. 駕駛資料管理
- **新增駕駛**: 完整表單輸入，支援分步驟填寫
- **編輯駕駛**: 即時編輯，自動儲存草稿
- **刪除駕駛**: 軟刪除機制，支援恢復
- **查看詳情**: 完整資料展示，歷史紀錄追蹤

#### 2. 搜尋與篩選功能
- **關鍵字搜尋**: 姓名、身分證字號、手機號碼
- **進階篩選**: 
  - 公司類別篩選
  - 狀態篩選（在籍/退籍）
  - 證照到期日範圍
  - 加入日期範圍
- **排序功能**: 支援多欄位排序
- **分頁顯示**: 可調整每頁顯示筆數

#### 3. 日期處理功能
- **民國年輸入**: 自動格式化（輸入數字時自動插入 `/`）
- **日期轉換**: 前端民國年 ↔ 後端西元年自動轉換
- **日期驗證**: 檢查日期合理性與邏輯性

#### 4. 證照管理功能
- **到期提醒**: 自動計算剩餘天數
- **批次提醒**: 產生即將到期清單
- **更新記錄**: 證照更新歷史追蹤

#### 5. 匯入匯出功能
- **Excel 匯入**: 支援批次新增，含錯誤檢查
- **Excel 匯出**: 支援篩選條件匯出
- **範本下載**: 提供標準匯入範本

### 使用者權限

#### 角色定義
- **系統管理員**: 
  - 完整的增刪改查功能
  - 權限管理功能
  - 系統設定管理
  - 匯入匯出功能

- **駕駛管理員**: 
  - 駕駛資料的增刪改查
  - 匯入匯出功能
  - 報表查看功能

- **一般使用者**: 
  - 駕駛資料查看
  - 基本搜尋功能
  - （權限可由管理員調整）

### 使用者故事

#### 管理員使用情境
```
作為駕駛管理員，我希望能夠：
1. 快速新增新進駕駛的完整資料
2. 在駕照或執照即將到期時收到提醒
3. 透過 Excel 批次匯入大量駕駛資料
4. 產生各種統計報表供主管參考
5. 追蹤駕駛的車隊異動歷史
```

#### 一般使用者使用情境
```
作為一般使用者，我希望能夠：
1. 快速搜尋特定駕駛的聯絡方式
2. 查看駕駛的基本資料和狀態
3. 篩選出特定公司的駕駛清單
4. 匯出符合條件的駕駛資料
```

## 🔧 技術架構

### 資料庫設計

#### drivers 資料表結構
```sql
CREATE TABLE drivers (
    id BIGINT UNSIGNED AUTO_INCREMENT PRIMARY KEY,
    company_category_id BIGINT UNSIGNED NULL,
    recurring_cost_id BIGINT UNSIGNED NULL,
    name VARCHAR(100) NOT NULL COMMENT '姓名',
    id_number VARCHAR(10) NOT NULL UNIQUE COMMENT '身分證字號',
    birthday DATE NULL COMMENT '生日',
    contact_address TEXT NULL COMMENT '通訊地址',
    residence_address TEXT NULL COMMENT '戶籍地址',
    home_phone VARCHAR(20) NULL COMMENT '住家電話',
    mobile_phone1 VARCHAR(20) NULL COMMENT '手機號碼1',
    mobile_phone2 VARCHAR(20) NULL COMMENT '手機號碼2',
    emergency_contact VARCHAR(100) NULL COMMENT '緊急聯絡人',
    emergency_phone VARCHAR(20) NULL COMMENT '緊急聯絡人電話',
    registration_date DATE NOT NULL DEFAULT CURRENT_DATE COMMENT '入籍日期',
    deregistration_date DATE NULL COMMENT '退籍日期',
    fleet_join_date DATE NULL COMMENT '加入車隊日期',
    fleet_leave_date DATE NULL COMMENT '退出車隊日期',
    license_expire_date DATE NULL COMMENT '駕照到期日',
    professional_license_expire_date DATE NULL COMMENT '執登到期日',
    status ENUM('open', 'close') NOT NULL DEFAULT 'open' COMMENT '狀態',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    deleted_at TIMESTAMP NULL COMMENT '軟刪除時間',
    
    FOREIGN KEY (company_category_id) REFERENCES company_categories(id),
    FOREIGN KEY (recurring_cost_id) REFERENCES recurring_costs(id),
    
    INDEX idx_name (name),
    INDEX idx_id_number (id_number),
    INDEX idx_status (status),
    INDEX idx_company_category (company_category_id),
    INDEX idx_license_expire (license_expire_date),
    INDEX idx_professional_expire (professional_license_expire_date)
);
```

### 後端架構

#### Laravel 實作規範
- **Model**: `App\Models\Driver`
- **Controller**: `App\Http\Controllers\Admin\DriverController`
- **Requests**: 
  - `App\Http\Requests\DriverStoreRequest`
  - `App\Http\Requests\DriverUpdateRequest`
- **Resources**: `App\Http\Resources\DriverResource`
- **路由群組**: `/admin/drivers`

#### API 端點設計
```php
// 駕駛管理路由
Route::prefix('admin')->middleware(['auth', 'role:admin'])->group(function () {
    Route::resource('drivers', DriverController::class);
    Route::get('drivers/export', [DriverController::class, 'export']);
    Route::post('drivers/import', [DriverController::class, 'import']);
    Route::get('drivers/expiring-licenses', [DriverController::class, 'expiringLicenses']);
});
```

### 前端架構

#### Vue 組件結構
```
resources/js/Pages/Admin/Drivers/
├── Index.vue           # 駕駛列表頁面
├── Create.vue          # 新增駕駛頁面
├── Edit.vue            # 編輯駕駛頁面
├── Show.vue            # 駕駛詳情頁面
└── Components/
    ├── DriverForm.vue      # 駕駛表單組件
    ├── DriverTable.vue     # 駕駛表格組件
    ├── SearchFilters.vue   # 搜尋篩選組件
    └── DateInput.vue       # 民國年日期輸入組件
```

## 📝 資料驗證與安全性

### 前端驗證規則
```javascript
const validationRules = {
    name: 'required|string|max:100',
    id_number: 'required|string|size:10|regex:/^[A-Z][0-9]{9}$/',
    mobile_phone1: 'nullable|regex:/^09[0-9]{8}$/',
    mobile_phone2: 'nullable|regex:/^09[0-9]{8}$/',
    home_phone: 'nullable|regex:/^0[0-9-]{8,12}$/',
    birthday: 'nullable|date|before:today',
    license_expire_date: 'nullable|date|after:today',
    professional_license_expire_date: 'nullable|date|after:today'
}
```

### 後端驗證規則
```php
// DriverStoreRequest
public function rules(): array
{
    return [
        'name' => 'required|string|max:100',
        'id_number' => 'required|string|size:10|unique:drivers,id_number|regex:/^[A-Z][0-9]{9}$/',
        'company_category_id' => 'nullable|exists:company_categories,id',
        'mobile_phone1' => 'nullable|regex:/^09[0-9]{8}$/',
        'birthday' => 'nullable|date|before:today',
        // ... 其他驗證規則
    ];
}
```

### 安全性措施
- **SQL 注入防護**: 使用 Eloquent ORM
- **XSS 防護**: 自動 HTML 轉義
- **CSRF 防護**: Laravel 內建 CSRF Token
- **檔案上傳安全**: 限制檔案類型與大小
- **權限控制**: Spatie Permission 套件
- **資料加密**: 敏感資料加密儲存

## 🎨 UI/UX 設計規範

### 介面設計原則
- **一致性**: 遵循 AdminLTE 4 設計語言
- **易用性**: 直觀的操作流程
- **響應式**: 支援桌面與行動裝置
- **無障礙**: 符合 WCAG 2.1 標準

### 頁面布局規範

#### 列表頁面
- **搜尋區**: 頂部固定搜尋和篩選條件
- **操作區**: 新增、匯入、匯出按鈕
- **表格區**: 分頁表格顯示
- **狀態指示**: 清楚的狀態標識

#### 表單頁面
- **分組顯示**: 將相關欄位分組
- **即時驗證**: 輸入時即時檢查格式
- **自動儲存**: 定期儲存草稿
- **進度指示**: 表單完成進度

### 使用者體驗設計

#### 日期輸入體驗
```javascript
// 民國年日期輸入組件
const DateInput = {
    // 自動格式化：111/1/1 → 111/01/01
    // 自動驗證：檢查日期合理性
    // 轉換提示：顯示對應西元年
}
```

#### 搜尋體驗
- **即時搜尋**: 輸入後延遲搜尋
- **搜尋建議**: 提供常用搜尋條件
- **歷史記錄**: 記住搜尋條件
- **清空重置**: 一鍵清空所有條件

## 🧪 測試規劃

### 單元測試
```php
// 測試駕駛模型
tests/Unit/Models/DriverTest.php

// 測試驗證規則
tests/Unit/Requests/DriverStoreRequestTest.php

// 測試日期轉換功能
tests/Unit/Helpers/DateHelperTest.php
```

### 功能測試
```php
// 測試駕駛 CRUD 功能
tests/Feature/Admin/DriverControllerTest.php

// 測試搜尋功能
tests/Feature/Admin/DriverSearchTest.php

// 測試匯入匯出功能
tests/Feature/Admin/DriverImportExportTest.php
```

### 前端測試
```javascript
// Vue 組件測試
tests/js/Components/DriverForm.spec.js
tests/js/Components/DateInput.spec.js

// E2E 測試
tests/e2e/driver-management.spec.js
```

## 📅 開發時程規劃

### Phase 1: 基礎功能開發 (2週)
- [ ] 資料庫設計與建立
- [ ] 基本 CRUD 功能
- [ ] 基本前端介面

### Phase 2: 進階功能開發 (2週)
- [ ] 搜尋篩選功能
- [ ] 日期處理功能
- [ ] 權限控制整合

### Phase 3: 擴展功能開發 (2週)
- [ ] 匯入匯出功能
- [ ] 證照到期提醒
- [ ] 報表統計功能

### Phase 4: 測試與優化 (1週)
- [ ] 完整測試覆蓋
- [ ] 效能優化
- [ ] 使用者體驗優化

## 🚀 部署與維護

### 環境需求
- PHP 8.4+
- Laravel 11.x
- MySQL 8.0+ / SQLite 3
- Node.js 18+
- Redis (快取)

### 部署清單
- [ ] 資料庫遷移執行
- [ ] 權限種子資料植入
- [ ] 前端資源編譯
- [ ] 快取設定
- [ ] 備份機制設定

### 維護計畫
- **每日**: 自動備份資料庫
- **每週**: 系統效能檢查
- **每月**: 安全性更新檢查
- **每季**: 功能使用分析

## 📊 效能指標

### 系統效能目標
- **頁面載入時間**: < 2 秒
- **搜尋回應時間**: < 1 秒
- **匯入處理時間**: 1000筆 < 30 秒
- **併發使用者**: 支援 100+ 同時線上

### 監控項目
- 資料庫查詢效能
- 記憶體使用量
- 磁碟空間使用
- 使用者行為分析


