# 公司管理開發規劃文件

此文件為公司管理系統開發的完整規劃文件，詳細記錄專案背景、需求分析、技術架構、開發計畫等。

## 📋 專案概述

### 專案背景
企業集團需要統一管理旗下多家子公司的基本資料，包含公司分類、基本資訊等，以建立完整的企業架構管理系統。

### 專案目標
- 建立統一的公司資料管理系統
- 提供公司分類功能，便於企業組織架構管理
- 實現公司資料的 CRUD 操作
- 為後續系統模組提供基礎資料支援

## 🎯 功能需求

### 核心功能
1. **公司類別管理**
   - 新增、編輯、刪除公司類別
   - 設定類別名稱與描述
   - 類別列表查看與搜尋

2. **公司資料管理**
   - 新增、編輯、刪除公司資料
   - 支援公司分類歸屬
   - 完整的公司基本資訊管理
   - 公司列表查看、搜尋與篩選

### 使用者權限
- **管理員權限**: 完整的增刪改查功能
- **一般使用者**: 僅查看權限（待後續需求確認）

## 📊 資料庫設計

### 資料表結構

#### 1. 公司類別表 (company_categories)

| 欄位名稱 | 資料類型 | 長度 | 約束 | 說明 |
|---------|---------|------|------|-----|
| id | BIGINT | - | PRIMARY KEY, AUTO_INCREMENT | 主鍵 |
| name | VARCHAR | 100 | NOT NULL, UNIQUE | 類別名稱 |
| description | TEXT | - | NULLABLE | 類別說明 |
| created_at | TIMESTAMP | - | DEFAULT CURRENT_TIMESTAMP | 建立時間 |
| updated_at | TIMESTAMP | - | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新時間 |

#### 2. 公司資料表 (companies)

| 欄位名稱 | 資料類型 | 長度 | 約束 | 說明 |
|---------|---------|------|------|-----|
| id | BIGINT | - | PRIMARY KEY, AUTO_INCREMENT | 主鍵 |
| category_id | BIGINT | - | NOT NULL, FOREIGN KEY | 公司類別 ID |
| name | VARCHAR | 200 | NOT NULL, UNIQUE | 公司名稱 |
| address | TEXT | - | NULLABLE | 公司地址 |
| tax_id | VARCHAR | 20 | NULLABLE, UNIQUE | 統一編號 |
| phone | VARCHAR | 50 | NULLABLE | 公司電話 |
| representative | VARCHAR | 100 | NULLABLE | 公司負責人 |
| email | VARCHAR | 255 | NULLABLE | 公司信箱 |
| website | VARCHAR | 255 | NULLABLE | 公司網站 |
| status | ENUM | - | DEFAULT 'active' | 狀態 (active/inactive) |
| created_at | TIMESTAMP | - | DEFAULT CURRENT_TIMESTAMP | 建立時間 |
| updated_at | TIMESTAMP | - | DEFAULT CURRENT_TIMESTAMP ON UPDATE | 更新時間 |

### 資料關聯
- `companies.category_id` ➜ `company_categories.id` (多對一關聯)

### 索引設計
- `company_categories.name` - 唯一索引
- `companies.name` - 唯一索引
- `companies.tax_id` - 唯一索引
- `companies.category_id` - 一般索引

## 🔧 技術架構

### 後端架構
- **框架**: Laravel 11.x
- **資料庫**: SQLite (開發) / MySQL (生產)
- **驗證**: Laravel Validation
- **權限**: Spatie Laravel Permission

#### Model 設計
```php
// CompanyCategory Model
- id, name, description, timestamps
- 關聯: hasMany(Company::class)

// Company Model  
- id, category_id, name, address, tax_id, phone, representative, email, website, status, timestamps
- 關聯: belongsTo(CompanyCategory::class)
```

#### Controller 設計
```
Admin/CompanyCategoryController
- index() - 列表頁面
- create() - 新增頁面  
- store() - 儲存資料
- edit() - 編輯頁面
- update() - 更新資料
- destroy() - 刪除資料

Admin/CompanyController
- index() - 列表頁面
- create() - 新增頁面
- store() - 儲存資料  
- show() - 詳細頁面
- edit() - 編輯頁面
- update() - 更新資料
- destroy() - 刪除資料
```

### 前端架構
- **框架**: Vue 3 + Inertia.js
- **樣式**: AdminLTE 4 + Bootstrap 5
- **圖示**: Bootstrap Icons

#### 頁面結構
```
resources/js/Pages/Admin/
├── CompanyCategories/
│   ├── Index.vue      # 類別列表
│   ├── Create.vue     # 新增類別
│   └── Edit.vue       # 編輯類別
└── Companies/
    ├── Index.vue      # 公司列表
    ├── Create.vue     # 新增公司
    ├── Show.vue       # 公司詳細
    └── Edit.vue       # 編輯公司
```

## 🎨 UI/UX 設計

### 頁面佈局
- 使用 AdminLTE 4 管理面板佈局
- 響應式設計，支援桌面和行動裝置
- 統一的操作按鈕和表單設計

### 側邊欄選單
```
公司管理
├── 公司類別管理
└── 公司資料管理
```

### 功能頁面設計

#### 列表頁面功能
- 資料表格顯示
- 搜尋功能
- 分頁顯示
- 排序功能
- 批量操作（選擇性實作）

#### 表單頁面功能
- 表單驗證
- 錯誤訊息顯示
- 必填欄位標示
- 友善的使用者體驗

## 📝 開發計畫

### 第一階段：基礎架構 (預估 3-5 天)
1. **資料庫遷移檔案**
   - 建立 company_categories 遷移
   - 建立 companies 遷移
   - 建立種子檔案

2. **Model 建立**
   - CompanyCategory Model
   - Company Model
   - 關聯關係設定

### 第二階段：後端開發 (預估 5-7 天)
1. **Controller 開發**
   - CompanyCategoryController
   - CompanyController
   
2. **Request 驗證類**
   - CompanyCategoryRequest
   - CompanyRequest

3. **路由設定**
   - 管理員路由群組
   - 資源路由設定

### 第三階段：前端開發 (預估 7-10 天)
1. **公司類別管理頁面**
   - 列表頁面 (Index.vue)
   - 新增/編輯頁面 (Create.vue, Edit.vue)

2. **公司資料管理頁面**
   - 列表頁面 (Index.vue)
   - 新增/編輯/詳細頁面 (Create.vue, Edit.vue, Show.vue)

3. **側邊欄選單整合**
   - AdminLayout 更新
   - 導航選單設定

### 第四階段：測試與優化 (預估 2-3 天)
1. **功能測試**
   - 單元測試
   - 功能測試

2. **使用者體驗優化**
   - 介面調整
   - 效能優化

## ⚠️ 注意事項與風險

### 開發注意事項
1. **資料驗證**
   - 公司名稱必須唯一
   - 統一編號若填寫必須唯一
   - 電話號碼格式驗證

2. **關聯完整性**
   - 刪除類別前檢查是否有關聯公司
   - 外鍵約束確保資料完整性

3. **權限控制**
   - 所有管理功能需要管理員權限
   - 中介軟體保護敏感操作

4. **前端組件注意事項**
   - **AdminLayout 必須傳入 user prop**: 所有使用 `AdminLayout` 的頁面都必須正確傳入 `<AdminLayout :user="$page.props.auth.user">` ，否則會導致白屏錯誤
   - **Bootstrap Modal 初始化**: 需要使用 `setTimeout` 延遲初始化避免 DOM 時機問題
   ```javascript
   onMounted(() => {
       setTimeout(() => {
           const modalElement = document.getElementById('deleteModal')
           if (modalElement && window.bootstrap) {
               deleteModal = new window.bootstrap.Modal(modalElement)
           }
       }, 100)
   })
   ```

### 潛在風險
1. **資料遷移風險**
   - 測試環境充分驗證後再部署生產環境

2. **效能考量**
   - 大量資料時的分頁效能
   - 搜尋功能的索引優化

## 📈 後續擴展計畫

### 階段性功能擴展
1. **匯入匯出功能**
   - Excel 匯入公司資料
   - 資料匯出功能

2. **進階搜尋**
   - 多條件組合搜尋
   - 進階篩選功能

3. **資料統計**
   - 公司數量統計
   - 類別分佈圖表

4. **API 介面**
   - RESTful API
   - 供其他系統整合使用

## 📚 技術文件

### Laravel Migration 範例
```php
// create_company_categories_table
Schema::create('company_categories', function (Blueprint $table) {
    $table->id();
    $table->string('name', 100)->unique();
    $table->text('description')->nullable();
    $table->timestamps();
});

// create_companies_table  
Schema::create('companies', function (Blueprint $table) {
    $table->id();
    $table->foreignId('category_id')->constrained('company_categories');
    $table->string('name', 200)->unique();
    $table->text('address')->nullable();
    $table->string('tax_id', 20)->nullable()->unique();
    $table->string('phone', 50)->nullable();
    $table->string('representative', 100)->nullable();
    $table->string('email')->nullable();
    $table->string('website')->nullable();
    $table->enum('status', ['active', 'inactive'])->default('active');
    $table->timestamps();
});
```

### 路由設定範例
```php
Route::prefix('admin')->name('admin.')->middleware(['auth', 'role:admin'])->group(function () {
    Route::resource('company-categories', CompanyCategoryController::class);
    Route::resource('companies', CompanyController::class);
});
```

---

**文件版本**: v1.0  
**最後更新**: {{ date('Y-m-d H:i:s') }}  
**負責人**: 開發團隊




