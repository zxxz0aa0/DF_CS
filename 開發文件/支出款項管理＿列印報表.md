# 支出款項管理 - 列印報表功能

## 📋 功能概述

支出款項管理系統新增「列印選中資料」功能，允許使用者勾選多筆支出款項後，開啟新視窗顯示列印報表。報表包含完整的交易明細和統計資訊,針對 A4 紙張列印進行優化。

### 主要特點

- ✅ **純前端實作** - 使用 localStorage 傳遞資料，無需後端資料庫查詢
- ✅ **即時響應** - 快速計算統計資訊並開啟列印頁面
- ✅ **列印優化** - 針對 A4 紙張進行專業排版，支援多頁列印
- ✅ **友善體驗** - 未選擇時按鈕禁用，提供清晰的錯誤提示
- ✅ **資料安全** - 自動清理 localStorage，避免資料殘留

---

## 🎯 使用流程

### 使用者操作流程

1. **選擇資料**：在支出款項列表頁勾選要列印的項目（可跨頁選擇）
2. **點擊列印**：點擊「列印選中資料」按鈕
3. **開啟報表**：系統在新視窗開啟列印報表頁面
4. **預覽確認**：檢視報表內容和統計資訊
5. **執行列印**：點擊「列印」按鈕或使用瀏覽器列印功能（Ctrl+P / Cmd+P）

### 系統處理流程

```
使用者勾選資料
    ↓
點擊「列印選中資料」按鈕
    ↓
驗證是否有選擇資料（無則提示）
    ↓
過濾選中的支出款項資料
    ↓
計算統計資訊（總筆數、總金額等）
    ↓
將資料儲存到 localStorage
    ↓
開啟新視窗（/admin/expense-payments/print）
    ↓
列印頁面從 localStorage 讀取資料
    ↓
渲染報表表格和統計資訊
    ↓
立即清理 localStorage
    ↓
使用者預覽並列印
```

---

## 🏗️ 技術架構

### 技術方案選擇

**採用方案：localStorage + 獨立 Vue 頁面**

#### 為何選擇這個方案？

| 優點 | 說明 |
|------|------|
| 符合專案架構 | 完全遵循 Vue 3 + Inertia.js 架構 |
| 實作簡單 | 不需修改後端資料庫查詢邏輯 |
| 效能優異 | 前端計算，無需等待後端處理 |
| 易於維護 | 程式碼結構清晰，職責分明 |
| 可擴展性強 | 未來可輕鬆新增自訂欄位、多種報表格式等 |

#### 其他方案對比

| 方案 | 優點 | 缺點 | 評分 |
|------|------|------|------|
| **localStorage + Vue 頁面**（✅採用） | 快速、無後端依賴、易維護 | 資料量過大時有限制（不適用） | ⭐⭐⭐⭐⭐ |
| URL 參數 + 後端路由 | SEO 友善、可書籤 | URL 長度限制、需後端查詢 | ⭐⭐⭐ |
| 純前端動態生成 HTML | 無需額外組件 | 程式碼混亂、難以維護 | ⭐⭐ |

---

## 📁 檔案結構

### 新增檔案（2 個）

#### 1. 列印頁面組件
**路徑**：`resources/js/Pages/Admin/ExpensePayments/Print.vue`

**功能**：
- 從 localStorage 讀取列印資料
- 渲染報表表格（9 個欄位）
- 顯示統計資訊區塊
- 提供「列印」和「關閉」按鈕
- 錯誤處理（無資料時顯示提示）

**程式碼結構**：
```vue
<template>
  <div class="print-container">
    <!-- 錯誤提示 -->
    <div v-if="errorMessage">...</div>

    <!-- 列印內容 -->
    <div v-else class="print-content">
      <!-- 報表標題 -->
      <div class="print-header">...</div>

      <!-- 資料表格 -->
      <table class="print-table">...</table>

      <!-- 統計資訊 -->
      <div class="print-statistics">...</div>

      <!-- 操作按鈕 -->
      <div class="print-actions no-print">...</div>
    </div>
  </div>
</template>

<script setup>
// 資料載入、格式化、列印邏輯
</script>

<style scoped>
@import '../../../css/print-expense-payments.css';
</style>
```

#### 2. 列印專用樣式
**路徑**：`resources/css/print-expense-payments.css`

**功能**：
- 螢幕顯示樣式（完整 Bootstrap 樣式）
- `@media print` 列印優化
- 響應式設計（行動裝置支援）

**樣式區塊**：
```css
/* 螢幕顯示樣式 */
.print-container { ... }
.print-header { ... }
.print-table { ... }
.statistics-table { ... }

/* 列印專用樣式 */
@media print {
  @page { size: A4; margin: 15mm; }
  .no-print { display: none !important; }
  .print-table thead { display: table-header-group; }
  /* ... 更多列印優化 */
}

/* 響應式設計 */
@media screen and (max-width: 768px) { ... }
```

### 修改檔案（3 個）

#### 1. 列表頁面組件
**路徑**：`resources/js/Pages/Admin/ExpensePayments/Index.vue`

**修改內容**：
- **行 72-81**：新增「列印選中資料」按鈕
- **行 728-771**：新增 `printSelectedData()` 函數

**新增按鈕**：
```vue
<button
  v-if="permissions.canExport"
  type="button"
  class="btn btn-outline-primary"
  :disabled="selectedIds.length === 0"
  @click="printSelectedData"
  title="列印選中的支出款項"
>
  <i class="bi bi-printer"></i> 列印選中資料
</button>
```

**核心函數**：
```javascript
// 列印選中的資料
function printSelectedData() {
  // 1. 驗證是否有選擇資料
  if (selectedIds.value.length === 0) {
    alert('請先選擇要列印的交易資料')
    return
  }

  try {
    // 2. 過濾選中的支出款項
    const selectedPayments = props.payments.data.filter(payment =>
      selectedIds.value.includes(payment.id)
    )

    // 3. 計算統計資訊
    const statistics = {
      totalCount: selectedPayments.length,
      totalGrossAmount: selectedPayments.reduce(...),
      totalDeduction: selectedPayments.reduce(...),
      totalNetAmount: selectedPayments.reduce(...)
    }

    // 4. 準備列印資料
    const printData = {
      payments: selectedPayments,
      statistics: statistics,
      printedAt: new Date().toISOString()
    }

    // 5. 儲存到 localStorage
    localStorage.setItem('expense_payments_print_data', JSON.stringify(printData))

    // 6. 開啟新視窗
    window.open(route('admin.expense-payments.print'), '_blank')

    // 7. 設定 5 分鐘後自動清理
    setTimeout(() => {
      localStorage.removeItem('expense_payments_print_data')
    }, 5 * 60 * 1000)

  } catch (error) {
    console.error('列印資料準備失敗:', error)
    alert('列印資料準備失敗，請稍後再試')
  }
}
```

#### 2. 路由設定
**路徑**：`routes/web.php`

**修改位置**：行 265（expense-payments 路由群組內）

**新增路由**：
```php
Route::get('print', [ExpensePaymentController::class, 'print'])
    ->name('print');
```

**完整路由群組**：
```php
Route::prefix('expense-payments')->name('expense-payments.')
    ->middleware('permission:view expense payments')
    ->group(function () {
        Route::get('/', [ExpensePaymentController::class, 'index'])->name('index');
        // ... 其他 CRUD 路由

        Route::post('bulk-status', [ExpensePaymentController::class, 'bulkStatus'])->name('bulk-status');
        Route::get('export', [ExpensePaymentController::class, 'export'])->name('export');
        Route::get('print', [ExpensePaymentController::class, 'print'])->name('print'); // ✅ 新增
        Route::get('template', [ExpensePaymentController::class, 'template'])->name('template');
        Route::post('import', [ExpensePaymentController::class, 'import'])->name('import');
    });
```

#### 3. 控制器
**路徑**：`app/Http/Controllers/Admin/ExpensePaymentController.php`

**修改位置**：行 138-147（export() 方法後）

**新增方法**：
```php
/**
 * 顯示列印頁面
 *
 * 前端會透過 localStorage 傳遞選中的資料
 * 此方法只負責渲染 Print.vue 頁面
 */
public function print(): Response
{
    return Inertia::render('Admin/ExpensePayments/Print');
}
```

---

## 📊 報表設計

### 報表欄位

報表顯示以下 9 個欄位（根據使用者需求設計）：

| 欄位名稱 | 資料來源 | 格式化 | 說明 |
|---------|---------|--------|------|
| 交易日期 | `record_date` | `formatDate()` | 支出款項的記錄日期 |
| 時間 | `record_time` | `formatTime()` | 僅顯示 HH:MM |
| 隊員編號 | `member_code` | - | 無則顯示「—」 |
| 隊員姓名 | `member_name` | - | 必填欄位 |
| 款項 | `item_name` | - | 款項名稱 |
| 支付金額 | `gross_amount` | `formatCurrency()` | 右對齊，千分位 |
| 應扣款 | `deduction` | `formatCurrency()` | 右對齊，千分位 |
| 實付金額 | `net_amount` | `formatCurrency()` | 右對齊，粗體，千分位 |
| 支付日期 | `payment_date` | `formatDate()` | 實際支付日期 |

### 統計資訊

報表底部顯示以下統計資訊：

```
┌─────────┬──────────┬───────────┬──────────┐
│ 總筆數   │ X 筆      │ 總支付金額  │ X,XXX 元  │
├─────────┼──────────┼───────────┼──────────┤
│ 總應扣款 │ X,XXX 元  │ 總實付金額  │ X,XXX 元  │
└─────────┴──────────┴───────────┴──────────┘
```

**計算邏輯**：
```javascript
const statistics = {
  totalCount: selectedPayments.length,
  totalGrossAmount: selectedPayments.reduce((sum, p) =>
    sum + parseFloat(p.gross_amount || 0), 0),
  totalDeduction: selectedPayments.reduce((sum, p) =>
    sum + parseFloat(p.deduction || 0), 0),
  totalNetAmount: selectedPayments.reduce((sum, p) =>
    sum + parseFloat(p.net_amount || 0), 0)
}
```

### 報表版面

```
┌────────────────────────────────────────┐
│     大豐交通企業 - 支出款項報表          │
│   列印時間：2024-12-20 14:30:25        │
└────────────────────────────────────────┘

┌──────┬──────┬────────┬────────┬──────┬──────┬──────┬──────┬──────┐
│交易日期│ 時間  │隊員編號 │隊員姓名 │ 款項  │支付金額│應扣款 │實付金額│支付日期│
├──────┼──────┼────────┼────────┼──────┼──────┼──────┼──────┼──────┤
│ ...資料列... │
└──────┴──────┴────────┴────────┴──────┴──────┴──────┴──────┴──────┘

統計資訊區塊（右側對齊）

┌────────┬──────┐
│[列印] [關閉]│ （螢幕顯示，列印時隱藏）
└────────┴──────┘
```

---

## 🎨 列印樣式優化

### A4 紙張設定

```css
@media print {
  @page {
    size: A4;           /* A4 紙張 */
    margin: 15mm;       /* 四邊邊距 15mm */
  }
}
```

### 列印優化項目

#### 1. 表頭重複顯示
確保多頁列印時每頁都顯示表頭：
```css
.print-table thead {
  display: table-header-group; /* 每頁重複顯示表頭 */
}
```

#### 2. 避免分頁切割
防止表格行在分頁時被切割：
```css
.print-table tbody tr {
  page-break-inside: avoid; /* 避免切割表格行 */
}
```

#### 3. 隱藏不必要元素
列印時隱藏操作按鈕等元素：
```css
.no-print,
.print-actions {
  display: none !important;
}
```

#### 4. 字體大小調整
列印時使用較小字體以節省空間：
```css
.print-table {
  font-size: 11px; /* 螢幕為 0.9rem (約 14.4px) */
}
```

#### 5. 黑白列印優化
```css
* {
  color: #000 !important;  /* 強制黑色文字 */
}

.table-bordered th,
.table-bordered td {
  border-color: #000 !important; /* 清晰的表格邊框 */
}
```

#### 6. 移除背景顏色
```css
.print-table tbody tr:nth-child(even) {
  background-color: transparent; /* 移除斑馬條紋 */
}
```

---

## 💾 資料傳遞機制

### localStorage 使用

**鍵名**：`expense_payments_print_data`

**資料結構**：
```javascript
{
  payments: [
    {
      id: 1,
      record_date: "2024-12-20",
      record_time: "14:30:00",
      member_code: "A001",
      member_name: "王小明",
      item_name: "油錢",
      gross_amount: "1000",
      deduction: "50",
      net_amount: "950",
      payment_date: "2024-12-20",
      // ... 其他欄位
    },
    // ... 更多支出款項
  ],
  statistics: {
    totalCount: 10,
    totalGrossAmount: 10000,
    totalDeduction: 500,
    totalNetAmount: 9500
  },
  printedAt: "2024-12-20T14:30:25.123Z"
}
```

### 資料清理機制

#### 雙重清理策略

1. **立即清理**（Print.vue）：
   ```javascript
   onMounted(() => {
     const data = localStorage.getItem('expense_payments_print_data')
     // ... 使用資料

     // 立即清理（避免重複使用舊資料）
     localStorage.removeItem('expense_payments_print_data')
   })
   ```

2. **延遲清理**（Index.vue）：
   ```javascript
   // 設定 5 分鐘後自動清理（避免資料殘留）
   setTimeout(() => {
     localStorage.removeItem('expense_payments_print_data')
   }, 5 * 60 * 1000)
   ```

#### 為何需要雙重清理？

| 情境 | 清理機制 | 說明 |
|------|---------|------|
| 正常使用 | 立即清理（Print.vue） | 列印頁面載入後立即清理 |
| 用戶取消開啟新視窗 | 延遲清理（Index.vue） | 5 分鐘後自動清理 |
| 瀏覽器封鎖彈出視窗 | 延遲清理（Index.vue） | 5 分鐘後自動清理 |
| 列印頁面載入失敗 | 延遲清理（Index.vue） | 5 分鐘後自動清理 |

---

## ⚠️ 錯誤處理

### 前端驗證

#### 1. 無選擇資料
```javascript
if (selectedIds.value.length === 0) {
  alert('請先選擇要列印的交易資料')
  return
}
```

**觸發方式**：使用者未勾選任何 checkbox 就點擊列印按鈕（但按鈕應該是禁用狀態）

#### 2. localStorage 無資料
```javascript
const data = localStorage.getItem('expense_payments_print_data')

if (!data) {
  errorMessage.value = '無列印資料，請返回列表頁重新選擇要列印的支出款項。'
  return
}
```

**觸發方式**：
- 直接訪問列印頁面 URL
- localStorage 被手動清除
- 資料過期（超過 5 分鐘）

#### 3. 資料格式錯誤
```javascript
try {
  const parsed = JSON.parse(data)

  if (!parsed.payments || parsed.payments.length === 0) {
    errorMessage.value = '列印資料為空，請返回列表頁重新選擇要列印的支出款項。'
    return
  }

  printData.value = parsed

} catch (error) {
  console.error('載入列印資料失敗:', error)
  errorMessage.value = '載入列印資料失敗，請返回列表頁重新操作。'
}
```

**觸發方式**：
- localStorage 資料被竄改
- JSON 格式不正確
- 資料結構不符合預期

#### 4. 列印資料準備失敗
```javascript
try {
  // ... 準備列印資料
} catch (error) {
  console.error('列印資料準備失敗:', error)
  alert('列印資料準備失敗，請稍後再試')
}
```

**觸發方式**：
- JavaScript 執行錯誤
- 資料計算異常

### 錯誤提示畫面

```vue
<div v-if="errorMessage" class="alert alert-danger m-5">
  <h4 class="alert-heading">無法載入列印資料</h4>
  <p>{{ errorMessage }}</p>
  <hr>
  <p class="mb-0">
    <button class="btn btn-secondary" @click="handleClose">關閉視窗</button>
  </p>
</div>
```

---

## 🔐 權限控制

### 按鈕權限

列印按鈕使用 `permissions.canExport` 權限控制：

```vue
<button
  v-if="permissions.canExport"
  type="button"
  class="btn btn-outline-primary"
  :disabled="selectedIds.length === 0"
  @click="printSelectedData"
>
  <i class="bi bi-printer"></i> 列印選中資料
</button>
```

**權限對應**：
- 權限名稱：`export expense payments`
- 中介軟體：已在 `ExpensePaymentController::__construct()` 設定

### 路由權限

列印頁面路由使用 `view expense payments` 權限：

```php
Route::get('print', [ExpensePaymentController::class, 'print'])
    ->name('print');
```

**繼承自路由群組**：
```php
Route::prefix('expense-payments')->name('expense-payments.')
    ->middleware('permission:view expense payments') // ← 繼承此權限
    ->group(function () { ... });
```

### 權限設計考量

| 方案 | 優點 | 缺點 | 決策 |
|------|------|------|------|
| 使用 `canExport` | 邏輯一致（列印屬於匯出類型） | 無法單獨控制列印權限 | ✅ 採用 |
| 新增 `print expense payments` | 更細緻的權限控制 | 需要執行 Seeder 新增權限 | 可選（未來擴展） |
| 使用 `canView` | 所有人都能列印 | 權限過於寬鬆 | ❌ 不採用 |

---

## 🧪 測試建議

### 功能測試

#### 基本功能
- [ ] 勾選單筆資料後列印
- [ ] 勾選多筆資料後列印
- [ ] 跨頁勾選資料後列印
- [ ] 未勾選資料時按鈕禁用
- [ ] 點擊按鈕開啟新視窗
- [ ] 報表資料正確顯示
- [ ] 統計資訊計算正確

#### 錯誤處理
- [ ] 無選擇時提示訊息
- [ ] localStorage 無資料時錯誤提示
- [ ] 資料格式錯誤時錯誤提示
- [ ] 關閉錯誤提示視窗

#### 資料清理
- [ ] 列印頁面載入後立即清理 localStorage
- [ ] 5 分鐘後自動清理 localStorage
- [ ] 重複列印時資料正確更新

### 樣式測試

#### 螢幕顯示
- [ ] Bootstrap 樣式正確套用
- [ ] 表格顯示完整
- [ ] 統計資訊區塊位置正確
- [ ] 按鈕樣式和位置正確
- [ ] 響應式設計（手機、平板）

#### 列印預覽
- [ ] A4 紙張適配
- [ ] 表頭每頁重複顯示
- [ ] 表格行不被分頁切割
- [ ] 按鈕和不必要元素隱藏
- [ ] 統計資訊不被分頁切割
- [ ] 黑白列印清晰可讀

### 瀏覽器相容性

- [ ] **Chrome**（推薦）- 完整測試
- [ ] **Firefox** - 列印預覽和實際列印
- [ ] **Edge** - 列印預覽和實際列印
- [ ] **Safari**（Mac）- 列印預覽和實際列印

### 權限測試

- [ ] 有 `export expense payments` 權限：按鈕顯示
- [ ] 無 `export expense payments` 權限：按鈕隱藏
- [ ] 有 `view expense payments` 權限：可訪問列印頁面
- [ ] 無 `view expense payments` 權限：無法訪問列印頁面（403）

---

## 🚀 使用指南

### 一般使用者

1. **登入系統**並進入「支出款項管理」頁面
2. **勾選 checkbox** 選擇要列印的支出款項（可跨頁選擇）
3. **點擊「列印選中資料」按鈕**（位於頁面上方工具列）
4. **檢視報表**：系統會在新視窗開啟列印報表頁面
5. **執行列印**：
   - 方式一：點擊報表頁面的「列印」按鈕
   - 方式二：使用瀏覽器列印功能（Ctrl+P / Cmd+P）
6. **設定列印選項**（瀏覽器列印對話框）：
   - 紙張大小：A4
   - 方向：縱向
   - 邊距：預設
   - 背景圖形：可選（建議開啟）
7. **確認並列印**

### 管理員

#### 權限設定

若需要單獨控制列印權限，可執行以下步驟：

1. **建立新權限**：
   ```php
   // database/seeders/ExpensePaymentPermissionSeeder.php
   Permission::create(['name' => 'print expense payments']);
   ```

2. **執行 Seeder**：
   ```bash
   php artisan db:seed --class=ExpensePaymentPermissionSeeder
   ```

3. **修改按鈕權限**：
   ```vue
   <!-- Index.vue -->
   <button
     v-if="permissions.canPrint"  <!-- 改為 canPrint -->
     ...
   >
   ```

4. **修改路由權限**：
   ```php
   // routes/web.php
   Route::get('print', [ExpensePaymentController::class, 'print'])
       ->name('print')
       ->middleware('permission:print expense payments');
   ```

5. **更新控制器**：
   ```php
   // ExpensePaymentController.php
   $this->middleware('permission:print expense payments')->only(['print']);
   ```

6. **分配權限給角色/職務**

---

## 🔧 維護指南

### 常見問題排查

#### 1. 列印頁面空白

**可能原因**：
- localStorage 資料被清除或過期
- 直接訪問列印頁面 URL

**解決方式**：
- 返回列表頁重新選擇並列印
- 檢查瀏覽器 Console 錯誤訊息

#### 2. 統計資訊計算錯誤

**可能原因**：
- 金額欄位為 `null` 或非數字
- JavaScript 浮點數計算精度問題

**解決方式**：
- 檢查資料庫欄位資料型態
- 使用 `parseFloat()` 確保數字轉換
- 必要時引入 `decimal.js` 處理精確計算

#### 3. 列印樣式異常

**可能原因**：
- CSS 檔案未正確引入
- 瀏覽器列印設定問題

**解決方式**：
- 檢查 `@import` 路徑是否正確
- 確認 CSS 檔案已編譯（`npm run build`）
- 調整瀏覽器列印設定

#### 4. 新視窗被封鎖

**可能原因**：
- 瀏覽器彈出視窗封鎖設定

**解決方式**：
- 提示使用者允許彈出視窗
- 在瀏覽器設定中將網站加入白名單

### 程式碼維護

#### 修改報表欄位

**步驟**：
1. 修改 `Print.vue` 的 `<thead>` 和 `<tbody>`
2. 調整 `print-expense-payments.css` 的欄位寬度
3. 測試列印效果

**範例**：新增「車牌」欄位
```vue
<!-- Print.vue -->
<thead>
  <tr>
    <!-- ... 現有欄位 -->
    <th>車牌</th> <!-- 新增 -->
  </tr>
</thead>
<tbody>
  <tr v-for="payment in printData.payments" :key="payment.id">
    <!-- ... 現有欄位 -->
    <td>{{ payment.vehicle_license_number || '—' }}</td> <!-- 新增 -->
  </tr>
</tbody>
```

#### 修改統計項目

**步驟**：
1. 修改 `Index.vue` 的 `printSelectedData()` 函數中的 `statistics` 物件
2. 修改 `Print.vue` 的統計資訊區塊

**範例**：新增「平均金額」統計
```javascript
// Index.vue
const statistics = {
  // ... 現有統計
  averageNetAmount: statistics.totalNetAmount / statistics.totalCount
}
```

```vue
<!-- Print.vue -->
<tr>
  <th>平均實付金額</th>
  <td class="text-end">{{ formatCurrency(printData.statistics.averageNetAmount) }}</td>
</tr>
```

#### 調整列印樣式

**常見調整**：

1. **修改邊距**：
   ```css
   @page {
     margin: 20mm; /* 改為 20mm */
   }
   ```

2. **調整字體大小**：
   ```css
   .print-table {
     font-size: 12px; /* 改為 12px */
   }
   ```

3. **修改表格寬度**：
   ```css
   .statistics-table {
     width: 80%; /* 改為 80% */
   }
   ```

---

## 📝 未來擴展建議

### 短期擴展（1-2 週）

#### 1. 自訂列印欄位
允許使用者選擇要顯示的欄位：

```vue
<!-- 新增欄位選擇器 -->
<div class="print-options">
  <label>
    <input type="checkbox" v-model="selectedFields" value="member_code"> 隊員編號
  </label>
  <label>
    <input type="checkbox" v-model="selectedFields" value="vehicle_license_number"> 車牌
  </label>
  <!-- ... 更多欄位 -->
</div>
```

**實作難度**：⭐⭐⭐（中等）
**預估時間**：4-6 小時

#### 2. 公司 Logo 和標題自訂
在系統設定中允許上傳 Logo 和自訂報表標題：

```vue
<!-- Print.vue -->
<div class="print-header">
  <img v-if="companyLogo" :src="companyLogo" alt="公司 Logo" class="company-logo">
  <h2>{{ companyName }} - 支出款項報表</h2>
</div>
```

**實作難度**：⭐⭐⭐⭐（較高）
**預估時間**：8-10 小時（含後端設定）

### 中期擴展（1 個月）

#### 3. 多種報表格式
提供簡版、詳版、彙總版等多種報表格式：

- **簡版**：僅顯示核心欄位（姓名、款項、金額）
- **詳版**：顯示所有欄位包含備註
- **彙總版**：按日期/駕駛/車輛分組統計

**實作難度**：⭐⭐⭐⭐（較高）
**預估時間**：16-20 小時

#### 4. 匯出為 PDF
使用 `html2pdf.js` 或後端 PDF 生成庫：

```javascript
// 使用 html2pdf.js
import html2pdf from 'html2pdf.js'

function exportPDF() {
  const element = document.querySelector('.print-content')
  html2pdf().from(element).save('expense_payments.pdf')
}
```

**實作難度**：⭐⭐⭐⭐⭐（高）
**預估時間**：12-16 小時

### 長期擴展（3 個月）

#### 5. 整合到其他管理頁面
將列印功能整合到：
- 駕駛管理
- 車輛管理
- 帳務記錄管理
- 催帳管理

**實作方式**：
1. 抽取共用的列印邏輯為 Composable
2. 建立通用的列印組件
3. 各頁面引入並自訂欄位

**實作難度**：⭐⭐⭐⭐⭐（高）
**預估時間**：40-60 小時

#### 6. 報表範本系統
建立報表範本管理系統，允許管理員建立和管理多種報表範本：

- 範本建立器（拖拉式介面）
- 範本儲存和管理
- 範本分享和匯入

**實作難度**：⭐⭐⭐⭐⭐（非常高）
**預估時間**：80-120 小時

---

## 📚 相關資源

### 專案檔案

- [列印頁面組件](../resources/js/Pages/Admin/ExpensePayments/Print.vue)
- [列印樣式檔案](../resources/css/print-expense-payments.css)
- [列表頁面組件](../resources/js/Pages/Admin/ExpensePayments/Index.vue)
- [路由設定](../routes/web.php)
- [控制器](../app/Http/Controllers/Admin/ExpensePaymentController.php)

### 相關技術文件

- [Vue 3 官方文件](https://vuejs.org/)
- [Inertia.js 文件](https://inertiajs.com/)
- [Bootstrap 5 文件](https://getbootstrap.com/)
- [CSS @media print 規範](https://developer.mozilla.org/en-US/docs/Web/CSS/@media/print)
- [localStorage API](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)

### 列印相關技術

- [CSS Print Layout](https://www.smashingmagazine.com/2018/05/print-stylesheets-in-2018/)
- [Print.js](https://printjs.crabbly.com/) - 列印增強庫（可選）
- [html2pdf.js](https://ekoopmans.github.io/html2pdf.js/) - PDF 生成庫（可選）

---

## 📋 變更歷史

### v1.0.0 - 2024-12-20

#### 新增功能
- ✅ 列印選中支出款項功能
- ✅ 報表統計資訊顯示
- ✅ A4 紙張列印優化
- ✅ 錯誤處理和提示
- ✅ localStorage 資料清理機制

#### 建立檔案
- `resources/js/Pages/Admin/ExpensePayments/Print.vue`
- `resources/css/print-expense-payments.css`

#### 修改檔案
- `resources/js/Pages/Admin/ExpensePayments/Index.vue`
- `routes/web.php`
- `app/Http/Controllers/Admin/ExpensePaymentController.php`

#### 技術細節
- 使用 localStorage 傳遞資料
- 純前端實作，無需後端資料庫查詢
- 支援跨頁選擇和批次列印
- 完整的錯誤處理機制
- 雙重資料清理策略

---

## 👥 開發團隊

**功能設計**：Ray
**技術實作**：Claude Code (AI Assistant)
**測試驗證**：待執行

**專案**：大豐交通企業車隊管理系統（DF_CS）
**版本**：1.0.0
**文件撰寫日期**：2024-12-20

---

## 📞 技術支援

若在使用或維護此功能時遇到問題，請參考：

1. **本文件**的「常見問題排查」章節
2. **專案 CLAUDE.md** 的開發指南
3. **瀏覽器 Console** 的錯誤訊息
4. **相關技術文件**連結

---

**文件版本**：1.0
**最後更新**：2024-12-20
**狀態**：✅ 已完成實作並撰寫文件
