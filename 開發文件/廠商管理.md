# 廠商管理開發規劃文件

此文件為廠商管理系統開發的完整規劃文件，詳細記錄專案背景、需求分析、技術架構、開發計畫等。

## 📋 專案概述

### 專案背景
企業集團需要統一管理旗下配合廠商的基本資料，以建立完整的企業架構管理系統。

### 專案目標
- 建立統一的廠商管理平台
- 提供完整的廠商基本資料管理
- 提升廠商資訊查詢效率
- 建立標準化的廠商資料格式

### 專案範圍
- 廠商基本資料管理（CRUD）
- 聯絡資訊管理
- 搜尋與篩選功能
- 資料匯出功能

## 🗄️ 資料庫設計

### vendors 資料表結構
| 欄位名稱 | 資料型態 | 必填 | 說明 | 備註 |
|---------|---------|------|------|------|
| id | bigint unsigned | 是 | 主鍵 | 自動遞增 |
| name | varchar(255) | 否 | 廠商名稱 | 無資料直接null |
| phone | varchar(50) | 否 | 廠商電話 | 無資料直接null |
| address | text | 否 | 廠商地址 | 無資料直接null |
| service_content | text | 否 | 服務內容 | 無資料直接null |
| note | text | 否 | 備註 | 無資料直接null |
| created_at | timestamp | 是 | 建立時間 | Laravel自動管理 |
| updated_at | timestamp | 是 | 更新時間 | Laravel自動管理 |

### 索引設計
- 主鍵：id
- 一般索引：name（用於搜尋）

## 🔧 技術實作架構

### 後端架構 (Laravel)

#### 1. 資料庫遷移 (Migration)
```php
// database/migrations/xxxx_create_vendors_table.php
Schema::create('vendors', function (Blueprint $table) {
    $table->id();
    $table->string('name')->nullable()->index();
    $table->string('phone', 50)->nullable();
    $table->text('address')->nullable();
    $table->text('service_content')->nullable();
    $table->text('note')->nullable();
    $table->timestamps();
});
```

#### 2. 模型 (Model)
```php
// app/Models/Vendor.php
class Vendor extends Model
{
    protected $fillable = [
        'name', 'phone', 'address', 'service_content', 'note'
    ];

    protected $casts = [
        'created_at' => 'datetime',
        'updated_at' => 'datetime',
    ];
}
```

#### 3. 控制器 (Controller)
- `App\Http\Controllers\Admin\VendorController`
- 提供 index, create, store, edit, update, destroy 方法
- 支援搜尋、分頁、排序功能

#### 4. 表單驗證 (Form Request)
- `App\Http\Requests\Admin\VendorRequest`
- 驗證廠商資料格式

#### 5. 路由設計
```php
// routes/web.php
Route::middleware(['auth', 'role:admin'])->prefix('admin')->group(function () {
    Route::resource('vendors', VendorController::class);
});
```

### 前端架構 (Vue 3 + Inertia.js)

#### 1. 頁面組件
- `resources/js/Pages/Admin/Vendors/Index.vue` - 廠商列表
- `resources/js/Pages/Admin/Vendors/Create.vue` - 新增廠商
- `resources/js/Pages/Admin/Vendors/Edit.vue` - 編輯廠商

#### 2. 共用組件
- `resources/js/Components/VendorForm.vue` - 廠商表單組件
- `resources/js/Components/VendorCard.vue` - 廠商卡片組件

#### 3. 使用 AdminLTE 4 樣式框架
- 整合 Bootstrap 5 樣式
- 使用 Bootstrap Icons
- 響應式設計

## 🎨 前端 UI/UX 設計

### 主要功能頁面設計

#### 1. 廠商列表頁面 (`/admin/vendors`)
**版面配置：**
- 使用 AdminLayout 版面
- 頁面標題：「廠商管理」
- 功能按鈕：「新增廠商」（右上角）

**功能區塊：**
- **搜尋欄**：廠商名稱搜尋框
- **資料表格**：
  - 欄位：編號、廠商名稱、電話、地址、服務內容、操作
  - 操作按鈕：編輯、刪除
  - 分頁控制：每頁顯示 15 筆資料

**互動設計：**
- 搜尋即時過濾
- 刪除前確認對話框
- Loading 狀態顯示

#### 2. 新增廠商頁面 (`/admin/vendors/create`)
**版面配置：**
- 使用 AdminLayout 版面
- 頁面標題：「新增廠商」
- 麵包屑：廠商管理 > 新增廠商

**表單設計：**
- **廠商名稱**：必填，文字輸入框
- **廠商電話**：選填，電話格式輸入框
- **廠商地址**：選填，文字區域輸入框
- **服務內容**：選填，文字區域輸入框
- **備註**：選填，文字區域輸入框

**按鈕配置：**
- 儲存按鈕（主要）、取消按鈕（次要）
- 表單驗證錯誤提示

#### 3. 編輯廠商頁面 (`/admin/vendors/{id}/edit`)
**版面配置：**
- 使用 AdminLayout 版面
- 頁面標題：「編輯廠商 - {廠商名稱}」
- 麵包屑：廠商管理 > 編輯廠商

**表單設計：**
- 與新增頁面相同的表單欄位
- 預填現有資料
- 顯示最後更新時間

### UI 組件規劃

#### 1. VendorForm 組件
- 可重用的廠商表單組件
- 支援新增/編輯模式
- 內建表單驗證
- 統一的樣式設計

#### 2. VendorCard 組件
- 廠商資訊卡片顯示
- 支援簡潔模式和詳細模式
- 適用於列表和詳情頁面

### 響應式設計
- **桌面版**：完整的表格顯示
- **平板版**：調整欄位寬度，隱藏次要欄位
- **手機版**：改為卡片式顯示，堆疊排列

### 互動體驗
- **載入狀態**：表單提交時顯示 Loading
- **成功提示**：操作成功時顯示 Toast 訊息
- **錯誤處理**：表單驗證錯誤即時顯示
- **確認對話框**：刪除操作前彈出確認視窗

## 🔐 權限管理規劃

### 權限架構設計

#### 使用 Spatie Laravel Permission 套件
- 基於角色的存取控制 (RBAC)
- 支援角色繼承和權限組合
- 與現有的使用者系統整合

#### 權限定義

**廠商管理相關權限：**
```php
// 權限列表
'vendor.view'     => '查看廠商列表',
'vendor.create'   => '新增廠商',
'vendor.edit'     => '編輯廠商',
'vendor.delete'   => '刪除廠商',
'vendor.export'   => '匯出廠商資料',
```

#### 角色設計

**管理員角色 (admin)：**
- 擁有所有廠商管理權限
- 可以查看、新增、編輯、刪除廠商
- 可以匯出廠商資料

**一般使用者角色 (user)：**
- 預設無廠商管理權限
- 可依需求個別指派特定權限

### 實作方式

#### 1. 權限種子檔案
```php
// database/seeders/VendorPermissionSeeder.php
public function run()
{
    $permissions = [
        'vendor.view',
        'vendor.create',
        'vendor.edit',
        'vendor.delete',
        'vendor.export'
    ];

    foreach ($permissions as $permission) {
        Permission::create(['name' => $permission]);
    }

    // 指派權限給管理員角色
    $adminRole = Role::findByName('admin');
    $adminRole->givePermissionTo($permissions);
}
```

#### 2. 中介軟體保護
```php
// routes/web.php
Route::middleware(['auth', 'permission:vendor.view'])->group(function () {
    Route::get('/admin/vendors', [VendorController::class, 'index']);
});

Route::middleware(['auth', 'permission:vendor.create'])->group(function () {
    Route::get('/admin/vendors/create', [VendorController::class, 'create']);
    Route::post('/admin/vendors', [VendorController::class, 'store']);
});
```

#### 3. 控制器中的權限檢查
```php
// VendorController.php
public function __construct()
{
    $this->middleware('permission:vendor.view')->only(['index', 'show']);
    $this->middleware('permission:vendor.create')->only(['create', 'store']);
    $this->middleware('permission:vendor.edit')->only(['edit', 'update']);
    $this->middleware('permission:vendor.delete')->only(['destroy']);
}
```

#### 4. 前端權限控制
```vue
<!-- Vue 組件中的權限檢查 -->
<template>
    <div>
        <button v-if="$page.props.auth.permissions.includes('vendor.create')"
                @click="createVendor">
            新增廠商
        </button>

        <button v-if="$page.props.auth.permissions.includes('vendor.edit')"
                @click="editVendor">
            編輯
        </button>
    </div>
</template>
```

### 安全性考量

#### 1. 多層次防護
- 路由層級權限檢查
- 控制器層級權限檢查
- 前端介面權限控制
- 資料庫查詢權限過濾

#### 2. 輸入驗證
- 所有使用者輸入必須經過驗證
- 防止 SQL 注入攻擊
- XSS 攻擊防護

#### 3. 操作記錄
- 記錄重要操作的使用者日誌
- 包含 IP 位址、操作時間、操作內容

#### 4. CSRF 保護
- 所有表單提交啟用 CSRF 保護
- API 請求驗證來源

## 📅 開發時程規劃

### 開發階段規劃

#### 第一階段：環境準備與基礎建設 (1-2 天)
**目標：** 建立開發環境和基礎架構

**任務清單：**
- [ ] 建立 vendors 資料表 migration
- [ ] 建立 Vendor 模型
- [ ] 建立權限種子檔案
- [ ] 執行資料庫遷移和種子
- [ ] 測試基礎資料結構

**預期產出：**
- 完整的資料庫結構
- 基本的權限設定
- 可運行的開發環境

#### 第二階段：後端 API 開發 (2-3 天)
**目標：** 完成所有後端功能

**任務清單：**
- [ ] 建立 VendorController
- [ ] 實作 CRUD 方法 (index, create, store, edit, update, destroy)
- [ ] 建立 VendorRequest 表單驗證
- [ ] 設定路由和中介軟體
- [ ] 實作搜尋和分頁功能
- [ ] 撰寫 API 測試

**預期產出：**
- 完整的 RESTful API
- 表單驗證機制
- 權限保護機制
- 單元測試覆蓋

#### 第三階段：前端介面開發 (3-4 天)
**目標：** 完成所有前端頁面和功能

**任務清單：**
- [ ] 建立廠商列表頁面 (Index.vue)
- [ ] 建立新增廠商頁面 (Create.vue)
- [ ] 建立編輯廠商頁面 (Edit.vue)
- [ ] 開發 VendorForm 共用組件
- [ ] 開發 VendorCard 共用組件
- [ ] 實作搜尋和分頁功能
- [ ] 實作刪除確認對話框
- [ ] 響應式設計調整

**預期產出：**
- 完整的使用者介面
- 可重用的 Vue 組件
- 響應式設計
- 良好的使用者體驗

#### 第四階段：整合測試與優化 (1-2 天)
**目標：** 確保系統穩定性和效能

**任務清單：**
- [ ] 前後端整合測試
- [ ] 權限功能測試
- [ ] 瀏覽器相容性測試
- [ ] 響應式設計測試
- [ ] 效能優化
- [ ] 程式碼重構
- [ ] 文件更新

**預期產出：**
- 穩定的系統功能
- 優化的效能表現
- 完整的測試覆蓋
- 更新的技術文件

### 總開發時程：7-11 天

### 開發里程碑

#### 里程碑 1：基礎架構完成
- **時間點：** 開發第 2 天
- **檢查項目：** 資料庫設計、權限設定、模型建立

#### 里程碑 2：後端 API 完成
- **時間點：** 開發第 5 天
- **檢查項目：** 所有 CRUD 功能、權限保護、API 測試

#### 里程碑 3：前端功能完成
- **時間點：** 開發第 9 天
- **檢查項目：** 所有頁面、組件、互動功能

#### 里程碑 4：專案完成
- **時間點：** 開發第 11 天
- **檢查項目：** 完整測試、效能優化、文件更新

### 風險評估與應對

#### 潛在風險
1. **技術風險：** AdminLTE 4 整合問題
   - **應對策略：** 提前測試樣式相容性，準備備用方案

2. **時程風險：** 前端開發時間可能超出預期
   - **應對策略：** 簡化 UI 設計，先完成核心功能

3. **整合風險：** 權限系統與現有系統衝突
   - **應對策略：** 詳細測試權限功能，確保向下相容

#### 品質保證
- **程式碼審查：** 每個階段完成後進行程式碼審查
- **測試覆蓋：** 確保重要功能有測試覆蓋
- **文件維護：** 即時更新技術文件和使用手冊

---

## 📋 檢查清單

### 開發完成檢查項目
- [ ] 資料庫結構正確建立
- [ ] 所有 CRUD 功能正常運作
- [ ] 權限控制正確實施
- [ ] 前端介面美觀易用
- [ ] 響應式設計正常
- [ ] 搜尋和分頁功能正常
- [ ] 表單驗證正確
- [ ] 錯誤處理完善
- [ ] 測試覆蓋率達標
- [ ] 程式碼符合專案規範

### 部署前檢查項目
- [ ] 生產環境設定檔
- [ ] 資料庫遷移檔案
- [ ] 權限種子檔案
- [ ] 前端資源編譯
- [ ] 快取清理機制
- [ ] 備份機制設定
 



